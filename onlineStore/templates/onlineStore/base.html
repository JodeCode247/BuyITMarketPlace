<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUY.IT</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
</head>
    
    
</head>
<style>
    a {
        text-decoration: none;
        color: inherit;
      }
        .cart-icon {
            position: relative; /* Needed for absolute positioning of badge */
            display: inline-block; /* Allows badge to be positioned relative to icon */
        }
        
        .cart-badge {
            position: absolute;
            top: -3px; /* Adjust as needed */
            right: -20px; /* Adjust as needed */
            background-color:rgb(206, 30, 68); /* Or your chosen color */
            color: white;
            border-radius: 80%; /* Creates a circle */
            padding: 4px 8px; /* Adjust padding for size */
            font-size: 12px; /* Adjust font size */
            min-width: 5px; /* Ensure a minimum width */
            text-align: center;
        }
        .cart-badge.hidden {
            display: none;
        }
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        background-color: #f4f4f4;
        color: #333;
    }
    
    header {
        background-color: orange;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        font-size: 24px;
        font-weight: bold;
        color: white;
    }
    
    nav ul {
        list-style-type: none;
    }
    
    nav ul li {
        display: inline;
        margin: 0 15px;
    }
    
    nav ul li a {
        color: white;
        text-decoration: none;
    }
    
    .hero {
        background-color: #ffcc80;
        padding: 50px 20px;
        text-align: center;
    }
    
    .hero h1 {
        font-size: 2.5rem;
        color: #333;
    }
    
    .hero p {
        font-size: 1.2rem;
        margin: 20px 0;
    }
    
    footer {
        background-color: #ffffff; /* White */
        margin-top: 2rem;
        padding: 1rem;
        text-align: center;
        color: #4b5563; /* Tailwind's gray-600 */
        font-size: 0.875rem; /* Tailwind's text-sm */
        border-top: 1px solid #e5e7eb;
    }
</style>
<style>

    .search-bar {
        position: center;
        
        
    }
    .bar {
        width: 350px;
        height: 50px;
    }

    .vertical-menu {
        position: fixed;
        /* Attach to the bottom */
        left: -250px; /* Start off-screen */
        width: 250px; /* Set the width */
        height: 100vh;; /* Auto height, based on content */
        /* Limit the maximum height */
        overflow-y: auto; /* Add scroll if content exceeds max height */
        background-color: white;
        border-top: 1px solid #ddd;
        border-right: 1px solid #ddd;
        padding: 20px;
        z-index: 1000;
        transition: left 0.3s ease; /* Smooth animation */
    }

    .vertical-menu.open {
        left: 0; /* Slide in when open */
    }

    .vertical-menu a {
        display: block;
        padding: 10px;
        text-decoration: none;
        color: #333;
    }

    .vertical-menu a:hover {
        color:  #FFD580;
        /* Light orange hover color */
    }

    .close-icon {
        cursor: pointer;
        font-size: 20px;
        float: left;
        padding : 10px
    }

    /* Content Shift */
    main {
        transition: margin-left 0.3s ease;
    }

    main.shifted {
        margin-left: 250px; /* Shift content when menu is open */
    }

    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh; /* Ensure the body takes up at least the full viewport height */
        margin: 0; /* Remove default body margin */
    }
    
    main { /* Or your main content container */
        flex: 1; /* Allow the main content to grow and fill available space */
    }
    /* Mobile-Specific Styles */
    @media (max-width: 767px) {
        .products {
            transition: opacity 0.3s ease;
        }

        .products.hidden {
            opacity: 0;
            pointer-events: none; /* Prevent clicks on hidden products */
        }
    }

    /* Footer Styles */
</style>
<style>
    .alert-container {
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      width: fit-content;
    }

    .alert {
      padding: 15px 20px;
      border-radius: 4px;
      border: 1px solid transparent;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border-color: #c3e6cb;
    }

    .alert-icon {
      font-size: 1.2rem;
    }

    .close-button {
      margin-left: auto;
      border: none;
      background: transparent;
      padding: 0;
      font-size: 1rem;
      color: #155724;
      cursor: pointer;
    }

    .close-button:hover {
      color: #0b2e13;
    }
</style>
<style>
        .btn {
            background-color: orange;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
        }
        
        .products {
            padding: 20px;
        }
        
        .products h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .product-grid {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .product {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px;
            padding: 10px;
            text-align: center;
            width: calc(30% - 20px); /* Default to 2 items per row */
            box-sizing: border-box; /* Include padding and border in element's total width and height */

        }
        
        .product img {
            max-width: 100%;
            height: auto;
        }
        
        .product button {
            background-color: orange;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        
        /* Desktop Styles */
    /* Desktop Styles */
    @media (min-width: 768px) {
        .product {
            width: calc(16.66% - 20px); /* 6 items per row */

        }
        .hero h1 {
            font-size: 2rem;
        }

        .hero p {
            font-size: 1rem;
    }

    /* Mobile Styles */
    @media (max-width: 480px) {
        .product {
            width: calc(25% - 20px); /* 4 items per row */
        }
        
            .hero h1 {
                font-size: 2rem;
            }
        
            .hero p {
                font-size: 1rem;
            }
        
        
 </style>



<body>
    {% if messages %}
        {% for message in messages %}
            <div class="alert-container" id="alert-container">
                <div class="alert alert-success" role="alert">
                    <i class="fa fa-check-circle alert-icon"></i>
                    <span id="alert-message">{{ message }}</span>
                    <button type="button" class="close-button" id="close-alert-button" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
        {% endfor %}
    {% endif %}
    
    {% block header %}
    
    <header>
        <div class="logo"><a href="{% url 'onlinestore:home' %}">BUY.IT</a></div>
        <nav>
            {% if request.user.is_authenticated %}
            <h4>Welcome {{request.user.username}}</h4>
            {% endif %}
            <ul>
                <li><a href="{% url 'onlinestore:home' %}">Home</a></li>
                <li><a href="{% url 'onlinestore:create_product' %}">Add product</a></li>
                {% if request.user.is_authenticated %}
                <li> <a href="{% url 'onlinestore:orders' %}"><strong>Orders</strong></a></li>
                <li><a href="{% url 'onlinestore:logout_user' %}">logout</a></li>
                {% else %}
                <li><a href="{% url 'onlinestore:login_user' %}">login</a></li>
                <li><a href="{% url 'onlinestore:register' %}">register</a></li>
                {% endif %}
                <li><div class="cart-icon"><a href="{% url 'onlinestore:cart' %}"><i class="fas fa-shopping-cart"></i><span class="cart-badge hidden" id ="cartBadge"></span></a></div></li>
                <li><a href="https://t.co/bL1FJYSvBM">Contact</a></li>

            </ul>
        </nav>
        
    </header>
    {% endblock header %}
    
    <script>
        function toggleMenu() {
            var menu = document.getElementById("verticalMenu");
            var main = document.querySelector("main");
            var products = document.querySelector(".products");
    
            if (menu.classList.contains("open")) {
                menu.classList.remove("open");
                main.classList.remove("shifted");
                if (window.innerWidth <= 767) {
                    products.classList.remove("hidden");
                }
            } else {
                menu.classList.add("open");
                main.classList.add("shifted");
                if (window.innerWidth <= 767) {
                    products.classList.add("hidden");
                }
            }
        }
    </script>
    <main>
    <div class="vertical-menu" id="verticalMenu">
        <div>
            <div class="" onclick="toggleMenu()"><strong>â¨‰ðŸ›’</strong></div>
        </div>
        <p>Categories</p>
        {% if request.user.is_authenticated %}
        
       
        <p> <a href="{% url 'onlinestore:orders' %}"><strong>Orders</strong></a></p>
        {% endif %}
        <p>
            <form action="" method="get">

        <a href="{% url 'onlinestore:home' %}?query=Electronics">Electronics</a>
        <a href="{% url 'onlinestore:home' %}?query=Clothing">Clothing</a>
        <a href="{% url 'onlinestore:home' %}?query=Home & Kitchen">Home & Kitchen</a>
        <a href="{% url 'onlinestore:home' %}?query=Books">Books</a>
        <a href="{% url 'onlinestore:home' %}?query=Beauty">Beauty</a>
        <a href="{% url 'onlinestore:home' %}?query=Sports">Sports</a>
        <a href="{% url 'onlinestore:home' %}?query=Health">Health</a>
        <a href="{% url 'onlinestore:home' %}?query=Grocery">Grocery</a>
        <a href="{% url 'onlinestore:home' %}?query=Automotive">Automotive</a>
        <a href="{% url 'onlinestore:home' %}?query=Baby">Baby</a>
        <a href="{% url 'onlinestore:home' %}?query=Pet Supplies">Pet Supplies</a>
        <a href="{% url 'onlinestore:home' %}?query=Tools">Tools</a>
        <a href="{% url 'onlinestore:home' %}?query=Garden">Garden</a>
        <a href="{% url 'onlinestore:home' %}?query=Office Supplies">Office Supplies</a>
        <a href="{% url 'onlinestore:home' %}?query=Musical Instruments">Musical Instruments</a>
        <a href="{% url 'onlinestore:home' %}?query=Jewelry">Jewelry</a>
        <a href="{% url 'onlinestore:home' %}?query=Footwear">Footwear</a>
        <a href="{% url 'onlinestore:home' %}?query=Accessories">Accessories</a>
        <a href="{% url 'onlinestore:home' %}?query=Furniture">Furniture</a>
        <a href="{% url 'onlinestore:home' %}?query=Toys">Toys</a>
        <a href="{% url 'onlinestore:home' %}?query=Video Games">Video Games</a>
        <a href="{% url 'onlinestore:home' %}?query=Movies">Movies</a>
        <a href="{% url 'onlinestore:home' %}?query=Music">Music</a>
        <a href="{% url 'onlinestore:home' %}?query=Software">Software</a>
        <a href="{% url 'onlinestore:home' %}?query=Photography">Photography</a>
        <a href="{% url 'onlinestore:home' %}?query=Cycling">Cycling</a>
        <a href="{% url 'onlinestore:home' %}?query=Running">Running</a>
        </form>
        <a href="#">Account</a>
        <a href="#">Wishlist</a>
        <a href="{% url 'onlinestore:cart' %}">Cart</a>
        
       
        <a href="#">Settings</a>
    </p>
    </div>
    
{% block content %}


{% endblock content %}
</main>
    <footer>
        <p>Â© 2025 saint JHN Shopping Site. All rights reserved.</p>
    </footer>
</body>


    <script>
        function delayedReload(delayInMilliseconds) {
            setTimeout(function() {
            window.location.reload();
            }, delayInMilliseconds);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const cartBadge = document.getElementById('cartBadge');
        
            function updateBadge(count) {
                if (count > 0) {
                    cartBadge.textContent = count;
                    cartBadge.classList.remove('hidden');
                } else {
                    cartBadge.classList.add('hidden');
                }
                
                count=0
            }
        
            function fetchCartCount() {
                fetch('/get_cart_count/') // Replace with your URL
                    .then(response => response.json())
                    .then(data => {
                        updateBadge(data.count);
                    })
                    .catch(error => {
                        console.error('Error fetching cart count:', error);
                    });
            }
        
            fetchCartCount(); // Initial fetch
        
            // Example: Update after removing an item
            document.querySelectorAll('.remove-button').forEach(button => {
                button.addEventListener('click', function() {
                    // Your AJAX code to remove the item...
                    fetchCartCount(); // Update the badge after removal
                });
            });
        
            // Example: Update after adding an item
            document.getElementById('addToCartButton').addEventListener('click', function() {
                // Your AJAX code to add the item...
                fetchCartCount(); // Update the badge after addition
            });
        });


        
        
        
        
        function delete_cart_item(productId) {
            fetch('/delete_cart_item/', { // Replace with your Django URL
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken') // Get CSRF token
                },
                body: JSON.stringify({
                    product_id: productId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('Cart item deleted successfully');
                    window.location.reload(); // Refresh the page
                    // Or you can update the cart content dynamically using JavaScript.
                } else {
                    console.error('Error deleting cart item:', data.message);
                    // Handle error (e.g., display a message to the user)
                }
            })
        
            .catch(error => {
                console.error('Error:', error);
                // Handle error
            });
        }


        function addItem(productId) {
            fetch('/add_to_cart/', { // Replace with your Django URL
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken') // Get CSRF token
                },
                body: JSON.stringify({
                    product_id: productId
                })
            })
            .then(response => response.json())
            .then(data => {
                window.location.reload();
                updateBadge(count)
                updateBadge();
            })
            .catch(error => {
                console.error('Error:', error);
                // Handle error
            });
        }

        


        function clearCart() {
            fetch('/clear_cart/', { 
                method: 'POST',
                headers: {
                'Content-Type': 'application/json', 
                'X-CSRFToken': getCookie('csrftoken'), 
                },
                
            })
            .then(response => {
                if (!response.ok) {
                throw new Error('Network response was not ok');
                }
                return response.json(); // Or response.text() if you're not returning JSON
            })
            .then(data => {
                // Handle success (e.g., display a message, update the UI)
                console.log('Cart cleared successfully:', data);
                alert('Cart cleared!'); // Basic alert.
                // Update the cart display or redirect the page as needed.
                location.reload(); //reload the page.su
            })
            .catch(error => {
                // Handle errors (e.g., display an error message)
                console.error('Error clearing cart:', error);
                location.reload();
            });
        }
    

    
     function updateCart(action,productId) {
            // Get the product ID
        
            // Send the AJAX request
            fetch('/cart/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    action: action,
                    product_id: productId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    if(data.action ==='payment' ){
                        alert('her');
                    }
                    console.log(data.message);
                    window.location.reload();  // Process success response
                    // Optionally, update the cart UI, e.g., update quantity displayed
                } else {
                    console.error(data.message);  // Handle the error response
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }


        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    

    </script>
    <script>
        const alertContainer = document.getElementById('alert-container');
        const closeAlertButton = document.getElementById('close-alert-button');


        if (alertContainer) { //check if the alert container exists.
            alertContainer.style.display = 'block'; // Show the alert

            closeAlertButton.addEventListener('click', () => {
                alertContainer.style.display = 'none';
            });

             // Optional: Close alert when clicking outside
            document.addEventListener('click', (event) => {
                if (!alertContainer.contains(event.target)) {
                    alertContainer.style.display = 'none';
                }
            });
        }


    </script>
</html>